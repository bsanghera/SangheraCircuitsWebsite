<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meditation Admin</title>
</head>
<body>
  <!-- Shim: if the Worker put #access_token=... in the opener URL, rebroadcast it to Decap in all formats -->
  <script>
    (function () {
      function rebroadcastFromHash() {
        try {
          var m = location.hash && location.hash.match(/access_token=([^&]+)/);
          if (!m) return;
          var token = decodeURIComponent(m[1]);

          // Broadcast in all formats used by Decap across versions
          window.postMessage('authorization:github:success:' + token, '*');
          window.postMessage('authorization:github:success', '*');
          window.postMessage({ token: token }, '*');
          window.postMessage({ type: 'authorization:github', status: 'success', token: token }, '*');

          // Clean the URL so the hash doesn't stick around
          history.replaceState(null, '', location.pathname + location.search);
        } catch (e) {}
      }
      rebroadcastFromHash();
      window.addEventListener('hashchange', rebroadcastFromHash);
    })();
  </script>

  <!-- Load Decap CMS (newer build) -->
  <script src="https://unpkg.com/decap-cms@^3.3.0/dist/decap-cms.js"></script>
</body>
</html>
