<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Meditation Admin</title>
</head>
<body>
  <!-- Shim: if the popup put #access_token=... in the opener URL, rebroadcast it -->
  <script>
    (function () {
      function rebroadcastFromHash() {
        try {
          var m = location.hash && location.hash.match(/access_token=([^&]+)/);
          if (!m) return;
          var token = decodeURIComponent(m[1]);

          // Send in every format Decap has used across versions
          window.postMessage('authorization:github:success:' + token, '*');
          window.postMessage('authorization:github:success', '*');
          window.postMessage({ token: token }, '*');
          window.postMessage({ type: 'authorization:github', status: 'success', token: token }, '*');

          // Clean the URL
          history.replaceState(null, '', location.pathname + location.search);
        } catch (e) { /* ignore */ }
      }

      // Run ASAP and also after the CMS script loads
      rebroadcastFromHash();
      window.addEventListener('hashchange', rebroadcastFromHash);
    })();
  </script>

  <!-- Load Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
</body>
</html>
